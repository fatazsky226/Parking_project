{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center">Liste des Parkings</h1>

    {% if parkings %}
        <div class="row">
            {% for parking in parkings %}
                <div class="col-md-4 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">{{ parking.name }}</h5>
                            <p class="card-text">
                                <strong>Emplacement :</strong> {{ parking.location }}<br>
                                <strong>Capacité :</strong> {{ parking.capacity }}<br>
                                <strong>Places disponibles :</strong> {{ parking.available_spaces }}
                            </p>
                            <a href="{% url 'parking_list' %}" class="btn btn-primary">
                                Voir Détails
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center">Aucun parking disponible pour le moment.</p>
    {% endif %}
</div>

<!-- Section du graphique -->
<div class="container mt-5">
    <h2 class="text-center">Statistiques des Parkings</h2>
    <canvas id="parkingChart" width="400" height="200"></canvas>
</div>

<!-- Inclusion de Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Données dynamiques extraites de la vue
    const parkingNames = {{ parking_names|safe }};
    const parkingCapacities = {{ parking_capacities|safe }};
    const parkingAvailableSpaces = {{ parking_available_spaces|safe }};

    // Configuration du graphique
    const ctx = document.getElementById('parkingChart').getContext('2d');
    const parkingChart = new Chart(ctx, {
        type: 'bar', // Type de graphique
        data: {
            labels: parkingNames, // Les noms des parkings
            datasets: [
                {
                    label: 'Capacité Totale',
                    data: parkingCapacities, // Capacités totales
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Places Disponibles',
                    data: parkingAvailableSpaces, // Places disponibles
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    enabled: true,
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
